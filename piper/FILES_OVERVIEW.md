# æ¾çµæœºæ¢°è‡‚æ¨ç†ç³»ç»Ÿæ–‡ä»¶æ€»è§ˆ

æœ¬ç›®å½•åŒ…å«æ¾çµï¼ˆPiperï¼‰åŒè‡‚æœºæ¢°è‡‚è¿›è¡Œå è¡£æœä»»åŠ¡æ¨ç†çš„æ‰€æœ‰å¿…è¦æ–‡ä»¶ã€‚

## ğŸ“ æ–‡ä»¶ç»“æ„

```
piper/
â”œâ”€â”€ piper_ctl.py                    # æ¾çµæœºæ¢°è‡‚åº•å±‚æ§åˆ¶SDKå°è£…
â”œâ”€â”€ piper_inference_client.py      # æ¨ç†å®¢æˆ·ç«¯ï¼ˆä¸»ç¨‹åºï¼‰â­
â”œâ”€â”€ run_piper_inference.sh         # å®¢æˆ·ç«¯å¯åŠ¨è„šæœ¬
â”œâ”€â”€ test_cameras.py                # ç›¸æœºæµ‹è¯•å·¥å…·
â”œâ”€â”€ QUICKSTART_inference.md        # å¿«é€Ÿå¼€å§‹æŒ‡å— ğŸ“–
â”œâ”€â”€ README_inference.md            # è¯¦ç»†ä½¿ç”¨æ–‡æ¡£ ğŸ“–
â””â”€â”€ FILES_OVERVIEW.md              # æœ¬æ–‡ä»¶
```

## ğŸ”§ æ ¸å¿ƒæ–‡ä»¶è¯´æ˜

### 1. `piper_ctl.py`
**ç±»å‹**: åº•å±‚æ§åˆ¶åº“  
**ç”¨é€”**: æ¾çµæœºæ¢°è‡‚çš„æ§åˆ¶æ¥å£å°è£…

**ä¸»è¦ç±»**:
- `PiperDualArmController`: åŒè‡‚æ§åˆ¶å™¨

**ä¸»è¦åŠŸèƒ½**:
- è¿æ¥å’Œä½¿èƒ½æœºæ¢°è‡‚
- å‘é€å…³èŠ‚å‘½ä»¤
- è·å–æœºæ¢°è‡‚çŠ¶æ€
- å¤¹çˆªæ§åˆ¶

**ä½¿ç”¨**: ä¸éœ€è¦ç›´æ¥è°ƒç”¨ï¼Œç”± `piper_inference_client.py` ä½¿ç”¨

---

### 2. `piper_inference_client.py` â­
**ç±»å‹**: ä¸»ç¨‹åº  
**ç”¨é€”**: è¿æ¥åˆ°æ¨ç†æœåŠ¡å™¨ï¼Œæ§åˆ¶æ¾çµæœºæ¢°è‡‚æ‰§è¡Œå è¡£æœä»»åŠ¡

**ä¸»è¦ç±»**:
- `PiperInferenceClient`: æ¨ç†å®¢æˆ·ç«¯

**ä¸»è¦åŠŸèƒ½**:
- è¿æ¥ pi05_fold_cloth æ¨ç†æœåŠ¡å™¨
- è·å–ç›¸æœºå›¾åƒå’Œæœºæ¢°è‡‚çŠ¶æ€
- æ„é€ è§‚æµ‹æ•°æ®å‘é€åˆ°æœåŠ¡å™¨
- æ¥æ”¶åŠ¨ä½œå¹¶æ§åˆ¶æœºæ¢°è‡‚æ‰§è¡Œ

**ä¾èµ–**:
- `piper_ctl.py` - æœºæ¢°è‡‚æ§åˆ¶
- `openpi_client.websocket_client_policy` - WebSocketé€šä¿¡
- `cv2` - ç›¸æœºå›¾åƒé‡‡é›†
- `numpy` - æ•°æ®å¤„ç†

**å‘½ä»¤è¡Œå‚æ•°**:
```bash
--host           # æ¨ç†æœåŠ¡å™¨åœ°å€ (é»˜è®¤: localhost)
--port           # æ¨ç†æœåŠ¡å™¨ç«¯å£ (é»˜è®¤: 8000)
--task           # ä»»åŠ¡æè¿° (é»˜è®¤: "Fold the cloth")
--max-steps      # æœ€å¤§æ­¥æ•° (é»˜è®¤: 1000)
--control-hz     # æ§åˆ¶é¢‘ç‡ (é»˜è®¤: 10.0)
--speed          # æœºæ¢°è‡‚é€Ÿåº¦ (é»˜è®¤: 50)
--left-can       # å·¦è‡‚CANç«¯å£ (é»˜è®¤: can_left)
--right-can      # å³è‡‚CANç«¯å£ (é»˜è®¤: can_right)
--cameras        # ç›¸æœºç´¢å¼• (é»˜è®¤: 0,1,2)
```

**ä½¿ç”¨ç¤ºä¾‹**:
```bash
python piper/piper_inference_client.py \
  --host localhost \
  --port 8000 \
  --speed 50 \
  --cameras 0,1,2
```

---

### 3. `run_piper_inference.sh`
**ç±»å‹**: Bashè„šæœ¬  
**ç”¨é€”**: ç®€åŒ–å®¢æˆ·ç«¯å¯åŠ¨æµç¨‹

**åŠŸèƒ½**:
- é…ç½®é»˜è®¤å‚æ•°
- å¯åŠ¨ `piper_inference_client.py`
- æ”¯æŒå‘½ä»¤è¡Œå‚æ•°è¦†ç›–

**ä½¿ç”¨ç¤ºä¾‹**:
```bash
# ä½¿ç”¨é»˜è®¤é…ç½®
bash piper/run_piper_inference.sh

# è‡ªå®šä¹‰å‚æ•°
bash piper/run_piper_inference.sh --host 192.168.1.100 --speed 60
```

---

### 4. `test_cameras.py`
**ç±»å‹**: æµ‹è¯•å·¥å…·  
**ç”¨é€”**: æµ‹è¯•å’ŒæŸ¥çœ‹ç›¸æœºè¿æ¥çŠ¶æ€

**åŠŸèƒ½**:
- `--mode list`: åˆ—å‡ºæ‰€æœ‰å¯ç”¨ç›¸æœº
- `--mode test`: å¿«é€Ÿæµ‹è¯•æŒ‡å®šç›¸æœº
- `--mode view`: å®æ—¶æŸ¥çœ‹ç›¸æœºç”»é¢

**ä½¿ç”¨ç¤ºä¾‹**:
```bash
# åˆ—å‡ºæ‰€æœ‰ç›¸æœº
python piper/test_cameras.py --mode list

# æµ‹è¯•ç‰¹å®šç›¸æœº
python piper/test_cameras.py --mode test --cameras 0,1,2

# å®æ—¶æŸ¥çœ‹ç”»é¢
python piper/test_cameras.py --mode view --cameras 0,1,2
```

---

## ğŸ“– æ–‡æ¡£è¯´æ˜

### `QUICKSTART_inference.md`
**ç”¨é€”**: 5åˆ†é’Ÿå¿«é€Ÿå¯åŠ¨æŒ‡å—

**åŒ…å«å†…å®¹**:
- å‰ç½®æ£€æŸ¥æ¸…å•
- ä¸‰æ­¥å¯åŠ¨æµç¨‹
- å¸¸è§é—®é¢˜å¿«é€Ÿè§£å†³
- å®Œæ•´å‘½ä»¤å‚è€ƒ

**é€‚åˆ**: 
- é¦–æ¬¡ä½¿ç”¨è€…
- éœ€è¦å¿«é€Ÿä¸Šæ‰‹çš„ç”¨æˆ·
- ä¸æƒ³çœ‹è¯¦ç»†æ–‡æ¡£çš„ç”¨æˆ·

---

### `README_inference.md`
**ç”¨é€”**: å®Œæ•´è¯¦ç»†çš„ä½¿ç”¨æ–‡æ¡£

**åŒ…å«å†…å®¹**:
- ç³»ç»Ÿæ¶æ„è¯´æ˜
- å‰ææ¡ä»¶è¯¦è§£
- å®Œæ•´ä½¿ç”¨æµç¨‹
- å‘½ä»¤è¡Œå‚æ•°è¯¦è§£
- æ•°æ®æ ¼å¼è¯´æ˜
- å¸¸è§é—®é¢˜ï¼ˆFAQï¼‰
- å®‰å…¨æ³¨æ„äº‹é¡¹
- æ€§èƒ½ä¼˜åŒ–å»ºè®®
- è°ƒè¯•æŠ€å·§

**é€‚åˆ**:
- æ·±å…¥äº†è§£ç³»ç»ŸåŸç†
- é‡åˆ°é—®é¢˜éœ€è¦æ’æŸ¥
- éœ€è¦è‡ªå®šä¹‰é…ç½®
- æ€§èƒ½è°ƒä¼˜

---

## ğŸš€ å¿«é€Ÿä½¿ç”¨æµç¨‹

### æ–°æ‰‹æ¨èæµç¨‹

1. **é˜…è¯»å¿«é€Ÿå¼€å§‹**: `QUICKSTART_inference.md`
2. **æµ‹è¯•ç›¸æœº**: `python piper/test_cameras.py --mode view`
3. **å¯åŠ¨æœåŠ¡å™¨**: åœ¨ç»ˆç«¯1è¿è¡Œæ¨ç†æœåŠ¡å™¨
4. **å¯åŠ¨å®¢æˆ·ç«¯**: åœ¨ç»ˆç«¯2è¿è¡Œ `bash piper/run_piper_inference.sh`
5. **é‡åˆ°é—®é¢˜**: æŸ¥çœ‹ `README_inference.md` çš„å¸¸è§é—®é¢˜éƒ¨åˆ†

### è¿›é˜¶ç”¨æˆ·æµç¨‹

1. **æµ‹è¯•ç¡¬ä»¶**: `python piper/test_cameras.py --mode list`
2. **å¯åŠ¨æœåŠ¡å™¨**: æ ¹æ®éœ€æ±‚é…ç½®RTCç­‰å‚æ•°
3. **è‡ªå®šä¹‰å®¢æˆ·ç«¯**: ç›´æ¥ä½¿ç”¨ `piper_inference_client.py` é…ç½®å‚æ•°
4. **æ€§èƒ½è°ƒä¼˜**: å‚è€ƒ `README_inference.md` çš„æ€§èƒ½ä¼˜åŒ–éƒ¨åˆ†

---

## ğŸ”— ä¾èµ–å…³ç³»

```
piper_inference_client.py
    â”œâ”€â”€ piper_ctl.py (æ¾çµæœºæ¢°è‡‚æ§åˆ¶)
    â”œâ”€â”€ openpi_client.websocket_client_policy (WebSocketé€šä¿¡)
    â”œâ”€â”€ cv2 (OpenCV - ç›¸æœº)
    â””â”€â”€ numpy (æ•°æ®å¤„ç†)

æ¨ç†æœåŠ¡å™¨ (scripts/serve_policy.py)
    â”œâ”€â”€ pi05_fold_cloth é…ç½®
    â”œâ”€â”€ checkpoint æ–‡ä»¶
    â””â”€â”€ norm_stats.json (å½’ä¸€åŒ–å‚æ•°)
```

---

## ğŸ“Š æ•°æ®æµ

```
ç›¸æœº â†’ piper_inference_client.py â†’ WebSocket â†’ æ¨ç†æœåŠ¡å™¨
  â†“                                                    â†“
æœºæ¢°è‡‚ â† piper_ctl.py â† piper_inference_client.py â† åŠ¨ä½œ
```

**è¯¦ç»†æµç¨‹**:
1. `piper_inference_client.py` ä»ç›¸æœºè·å–å›¾åƒ
2. ä» `piper_ctl.py` è·å–æœºæ¢°è‡‚çŠ¶æ€
3. æ„é€ è§‚æµ‹æ•°æ®ï¼Œé€šè¿‡ WebSocket å‘é€åˆ°æ¨ç†æœåŠ¡å™¨
4. æ¨ç†æœåŠ¡å™¨è¿”å›åŠ¨ä½œåºåˆ—
5. `piper_inference_client.py` é€šè¿‡ `piper_ctl.py` æ§åˆ¶æœºæ¢°è‡‚æ‰§è¡ŒåŠ¨ä½œ

---

## âš™ï¸ é…ç½®æ–‡ä»¶ä½ç½®

- **è®­ç»ƒé…ç½®**: `src/openpi/training/config.py` (pi05_fold_cloth)
- **å½’ä¸€åŒ–å‚æ•°**: `assets/pi05_fold_cloth/fold_cloth/norm_stats.json`
- **Checkpoint**: `checkpoints/pi05_fold_cloth/fold_cloth_experiment/19999/`

---

## ğŸ› ï¸ å¼€å‘å’Œè°ƒè¯•

### æ·»åŠ æ—¥å¿—
```python
import logging
logging.basicConfig(level=logging.DEBUG)
```

### ä¿®æ”¹ç›¸æœºåˆ†è¾¨ç‡
ç¼–è¾‘ `piper_inference_client.py`:
```python
cap.set(cv2.CAP_PROP_FRAME_WIDTH, 1280)
cap.set(cv2.CAP_PROP_FRAME_HEIGHT, 720)
```

### è°ƒæ•´æ§åˆ¶é¢‘ç‡
```bash
python piper/piper_inference_client.py --control-hz 15.0
```

### æŸ¥çœ‹ç›¸æœºç”»é¢ï¼ˆç”¨äºè°ƒè¯•ï¼‰
åœ¨ `piper_inference_client.py` çš„ `run_control_loop` ä¸­æ·»åŠ :
```python
cv2.imshow('Top', top_image)
cv2.waitKey(1)
```

---

## ğŸ“ ç‰ˆæœ¬ä¿¡æ¯

- **åˆ›å»ºæ—¥æœŸ**: 2025-11
- **å…¼å®¹æ¨¡å‹**: pi05_fold_cloth
- **Pythonç‰ˆæœ¬**: 3.8+
- **ä¸»è¦ä¾èµ–**: 
  - openpi_client
  - piper_sdk
  - opencv-python
  - numpy

---

## ğŸ¤ è´¡çŒ®

å¦‚æœä½ åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­å‘ç°é—®é¢˜æˆ–æœ‰æ”¹è¿›å»ºè®®ï¼Œè¯·ï¼š
1. æŸ¥çœ‹æ–‡æ¡£æ˜¯å¦å·²æœ‰è§£å†³æ–¹æ¡ˆ
2. è®°å½•è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’Œæ—¥å¿—
3. æä¾›å¤ç°æ­¥éª¤

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

é‡åˆ°é—®é¢˜æ—¶çš„æ£€æŸ¥é¡ºåºï¼š
1. æŸ¥çœ‹ `QUICKSTART_inference.md` å¸¸è§é—®é¢˜éƒ¨åˆ†
2. æŸ¥çœ‹ `README_inference.md` è¯¦ç»†çš„æ•…éšœæ’é™¤
3. æ£€æŸ¥æ—¥å¿—è¾“å‡ºä¸­çš„é”™è¯¯ä¿¡æ¯
4. ä½¿ç”¨ `test_cameras.py` éªŒè¯ç¡¬ä»¶è¿æ¥
5. ç¡®è®¤æ¨ç†æœåŠ¡å™¨æ­£å¸¸è¿è¡Œ

---

## ğŸ¯ ä½¿ç”¨å»ºè®®

**é¦–æ¬¡ä½¿ç”¨**:
- ä» `QUICKSTART_inference.md` å¼€å§‹
- ä½¿ç”¨ä½é€Ÿæ¨¡å¼ (`--speed 30`)
- ä¿æŒæ€¥åœæŒ‰é’®å¯è§¦åŠ

**æ—¥å¸¸ä½¿ç”¨**:
- ä½¿ç”¨ `run_piper_inference.sh` å¿«é€Ÿå¯åŠ¨
- æ ¹æ®ä»»åŠ¡è°ƒæ•´é€Ÿåº¦å‚æ•°
- å®šæœŸæ£€æŸ¥ç›¸æœºå’Œæœºæ¢°è‡‚çŠ¶æ€

**æ€§èƒ½ä¼˜åŒ–**:
- å¯ç”¨RTCå¹³æ»‘åŠŸèƒ½
- æ ¹æ®ä»»åŠ¡è°ƒæ•´æ§åˆ¶é¢‘ç‡
- ç¡®ä¿æ¨ç†æœåŠ¡å™¨ä½¿ç”¨GPU

---

å¸Œæœ›è¿™ä¸ªæ–‡ä»¶æ€»è§ˆèƒ½å¸®åŠ©ä½ å¿«é€Ÿäº†è§£æ•´ä¸ªç³»ç»Ÿï¼ğŸš€

